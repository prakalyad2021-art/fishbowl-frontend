@startuml Fishbowl_System_Architecture
!theme aws-orange
skinparam linetype ortho
skinparam backgroundColor #FFFFFF
skinparam defaultFontSize 10
skinparam componentStyle rectangle

title Fishbowl Social Media Application - System Architecture\nComplete AWS Services Integration

' Define AWS Service Colors
skinparam component {
    BackgroundColor<<AWS>> #FF9900
    BorderColor<<AWS>> #232F3E
    FontColor<<AWS>> #FFFFFF
    FontStyle<<AWS>> bold
}

skinparam component {
    BackgroundColor<<Frontend>> #4A90E2
    BorderColor<<Frontend>> #2E5C8A
    FontColor<<Frontend>> #FFFFFF
}

skinparam component {
    BackgroundColor<<Database>> #3F48CC
    BorderColor<<Database>> #2E3A8A
    FontColor<<Database>> #FFFFFF
}

skinparam component {
    BackgroundColor<<Storage>> #569A31
    BorderColor<<Storage>> #3D6B22
    FontColor<<Storage>> #FFFFFF
}

' Frontend Layer
package "Frontend Layer" <<Frontend>> {
    component [React Application\nVite + React 19] as ReactApp
    component [Fishbowl Module\nReal-time Presence] as Fishbowl
    component [Chatroom Module\nReal-time Chat] as Chatroom
    component [Prompts Module\nDaily Questions] as Prompts
    component [Media Module\nFeed & Upload] as Media
    component [Journal Module\nPersonal Entries] as Journal
    component [Calendar Module\nEvent Planning] as Calendar
    component [Stats Module\nAnalytics] as Stats
}

' AWS Amplify Services
package "AWS Amplify Platform" <<AWS>> {
    component [Amplify Hosting\nStatic Site + CI/CD] as AmplifyHosting <<AWS>>
    component [Amplify Console\nBuild Pipeline] as AmplifyConsole <<AWS>>
}

' Authentication Services
package "Authentication Services" <<AWS>> {
    component [Cognito User Pool\nSign-up/Sign-in] as CognitoUserPool <<AWS>>
    component [Cognito Identity Pool\nAWS Credentials] as CognitoIdentityPool <<AWS>>
    component [IAM Roles & Policies\nAccess Control] as IAM <<AWS>>
}

' API & Data Services
package "API & Data Services" <<AWS>> {
    component [AppSync GraphQL API\nReal-time Subscriptions] as AppSync <<AWS>>
    component [DynamoDB\n10 Tables] as DynamoDB <<Database>>
    database "DynamoDB Tables" <<Database>> {
        component [User Table] as UserTable
        component [Message Table] as MessageTable
        component [Mood Table] as MoodTable
        component [Prompt Table] as PromptTable
        component [PromptResponse Table] as PromptResponseTable
        component [MediaPost Table] as MediaPostTable
        component [MediaComment Table] as MediaCommentTable
        component [JournalEntry Table] as JournalEntryTable
        component [CalendarEvent Table] as CalendarEventTable
        component [UserStats Table] as UserStatsTable
    }
    DynamoDB --> UserTable
    DynamoDB --> MessageTable
    DynamoDB --> MoodTable
    DynamoDB --> PromptTable
    DynamoDB --> PromptResponseTable
    DynamoDB --> MediaPostTable
    DynamoDB --> MediaCommentTable
    DynamoDB --> JournalEntryTable
    DynamoDB --> CalendarEventTable
    DynamoDB --> UserStatsTable
}

' Storage Services
package "Storage Services" <<AWS>> {
    component [S3 Bucket\nMedia Storage] as S3 <<Storage>>
}

' Compute Services
package "Compute Services" <<AWS>> {
    component [Lambda Function\nCalendar Reminders] as Lambda <<AWS>>
    component [EventBridge\nScheduled Triggers] as EventBridge <<AWS>>
}

' Monitoring Services
package "Monitoring Services" <<AWS>> {
    component [CloudWatch\nLogs & Metrics] as CloudWatch <<AWS>>
}

' User
actor User as user

' Frontend Connections
user --> ReactApp : "Access Application"
ReactApp --> Fishbowl
ReactApp --> Chatroom
ReactApp --> Prompts
ReactApp --> Media
ReactApp --> Journal
ReactApp --> Calendar
ReactApp --> Stats

' Deployment Flow
ReactApp --> AmplifyHosting : "Deployed via"
AmplifyHosting --> AmplifyConsole : "Managed by"

' Authentication Flow
ReactApp --> CognitoUserPool : "1. Sign-up/Sign-in"
CognitoUserPool --> CognitoIdentityPool : "2. Get Identity"
CognitoIdentityPool --> IAM : "3. Assume Role"
IAM --> S3 : "4. Grant S3 Access"
IAM --> AppSync : "4. Grant API Access"

' API Connections - Fishbowl
Fishbowl --> AppSync : "Query/Subscribe\nUser & Mood"
AppSync --> DynamoDB : "Data Operations"
AppSync --> UserTable : "Read/Write"
AppSync --> MoodTable : "Read/Write"
AppSync ..> Fishbowl : "Real-time Updates\n(WebSocket)"

' API Connections - Chatroom
Chatroom --> AppSync : "Query/Subscribe\nMessages"
AppSync --> DynamoDB : "Data Operations"
AppSync --> MessageTable : "Read/Write"
AppSync ..> Chatroom : "Real-time Messages\n(WebSocket)"
Chatroom --> S3 : "Upload Media"
S3 --> Chatroom : "Media URL"

' API Connections - Prompts
Prompts --> AppSync : "Query/Subscribe\nPrompts & Responses"
AppSync --> DynamoDB : "Data Operations"
AppSync --> PromptTable : "Read/Write"
AppSync --> PromptResponseTable : "Read/Write"
AppSync ..> Prompts : "Real-time Responses\n(WebSocket)"

' API Connections - Media
Media --> AppSync : "Query/Subscribe\nPosts & Comments"
AppSync --> DynamoDB : "Data Operations"
AppSync --> MediaPostTable : "Read/Write"
AppSync --> MediaCommentTable : "Read/Write"
AppSync ..> Media : "Real-time Posts\n(WebSocket)"
Media --> S3 : "Upload Media Files"
S3 --> Media : "Media URLs"

' API Connections - Journal
Journal --> AppSync : "Query/Write\nEntries"
AppSync --> DynamoDB : "Data Operations"
AppSync --> JournalEntryTable : "Read/Write"

' API Connections - Calendar
Calendar --> AppSync : "Query/Subscribe\nEvents"
AppSync --> DynamoDB : "Data Operations"
AppSync --> CalendarEventTable : "Read/Write"
AppSync ..> Calendar : "Real-time Events\n(WebSocket)"

' API Connections - Stats
Stats --> AppSync : "Query\nStatistics"
AppSync --> DynamoDB : "Data Operations"
AppSync --> UserStatsTable : "Read/Write"

' Scheduled Tasks Flow
EventBridge --> Lambda : "Daily 9 AM UTC\nTrigger"
Lambda --> AppSync : "Query Events"
AppSync --> DynamoDB : "Data Operations"
AppSync --> CalendarEventTable : "Read Events"
Lambda --> CloudWatch : "Log Results"

' Monitoring
AppSync --> CloudWatch : "API Logs"
Lambda --> CloudWatch : "Function Logs"
S3 --> CloudWatch : "Access Logs"
CognitoUserPool --> CloudWatch : "Auth Logs"

' Data Flow Annotations
note right of AppSync
  **Real-time Subscriptions:**
  - User presence updates
  - New messages
  - Mood changes
  - New posts/comments
  - Calendar events
end note

note right of S3
  **Media Storage:**
  - Photos
  - Videos
  - Audio files
  - GIFs
  Path: media/{identity_id}/*
end note

note right of Lambda
  **Scheduled Function:**
  - Runs daily at 9 AM UTC
  - Checks CalendarEvent table
  - Sends reminders to tagged users
end note

note right of DynamoDB
  **10 DynamoDB Tables:**
  1. User
  2. Message
  3. Mood
  4. Prompt
  5. PromptResponse
  6. MediaPost
  7. MediaComment
  8. JournalEntry
  9. CalendarEvent
  10. UserStats
end note

legend right
  |<#FF9900> AWS Service |
  |<#4A90E2> Frontend Component |
  |<#3F48CC> Database |
  |<#569A31> Storage |
  |--| Data Flow |
  |..| Real-time Subscription |
  |==| Scheduled Trigger |
endlegend

@enduml

