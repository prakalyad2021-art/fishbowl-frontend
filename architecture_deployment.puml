@startuml Fishbowl_Deployment_Architecture
!theme aws-orange
skinparam linetype ortho
skinparam backgroundColor #F8F9FA
skinparam defaultFontSize 10
skinparam componentStyle rectangle

title Fishbowl Application - AWS Deployment Architecture\nService Topology & Connections

' Define AWS Service Colors
skinparam component {
    BackgroundColor<<AWS>> #FF9900
    BorderColor<<AWS>> #232F3E
    FontColor<<AWS>> #FFFFFF
    FontStyle<<AWS>> bold
}

skinparam component {
    BackgroundColor<<Frontend>> #4A90E2
    BorderColor<<Frontend>> #2E5C8A
    FontColor<<Frontend>> #FFFFFF
}

skinparam component {
    BackgroundColor<<Database>> #3F48CC
    BorderColor<<Database>> #2E3A8A
    FontColor<<Database>> #FFFFFF
}

skinparam component {
    BackgroundColor<<Storage>> #569A31
    BorderColor<<Storage>> #3D6B22
    FontColor<<Storage>> #FFFFFF
}

' User
actor "End User" as user

' Frontend
rectangle "Frontend Application" <<Frontend>> {
    rectangle "React App\n(Vite + React 19)" as ReactApp
    rectangle "8 Page Modules" as Pages
    rectangle "Utilities\n(Data/Storage Clients)" as Utils
}

' AWS Services
rectangle "AWS Amplify Platform" {
    component [Amplify Hosting\nFrontend Hosting\nCI/CD Pipeline] as AmplifyHosting <<AWS>>
    component [Amplify Console\nBuild Management\nBackend Config] as AmplifyConsole <<AWS>>
}

rectangle "Authentication & Authorization" {
    component [Cognito User Pool\nSign-up/Sign-in] as CognitoUserPool <<AWS>>
    component [Cognito Identity Pool\nAWS Credentials] as CognitoIdentityPool <<AWS>>
    component [IAM Roles\nAccess Policies] as IAMRoles <<AWS>>
}

rectangle "API & Data Layer" {
    component [AppSync\nGraphQL API\nReal-time Subscriptions] as AppSyncAPI <<AWS>>
    component [DynamoDB\n10 Tables\nNoSQL Database] as DynamoDB <<Database>>
}

rectangle "Storage Layer" {
    component [S3 Bucket\nMedia Storage\nfishbowlMedia] as S3Bucket <<Storage>>
}

rectangle "Compute & Scheduling" {
    component [Lambda Function\nCalendar Reminder\nServerless] as LambdaFunction <<AWS>>
    component [EventBridge\nScheduler\nDaily 9 AM UTC] as EventBridge <<AWS>>
}

rectangle "Monitoring & Logging" {
    component [CloudWatch\nLogs & Metrics\nService Monitoring] as CloudWatch <<AWS>>
}

' Connections
user --> ReactApp : "HTTPS"
ReactApp --> Pages
ReactApp --> Utils

ReactApp --> AmplifyHosting : "Deployed on"
AmplifyHosting --> AmplifyConsole : "Managed by"

ReactApp --> CognitoUserPool : "1. Authenticate"
CognitoUserPool --> CognitoIdentityPool : "2. Get Identity"
CognitoIdentityPool --> IAMRoles : "3. Assume Role"
IAMRoles --> AppSyncAPI : "4. Authorize API"
IAMRoles --> S3Bucket : "4. Authorize Storage"

Utils --> AppSyncAPI : "GraphQL\nQueries/Mutations"
AppSyncAPI --> DynamoDB : "Data Operations"
AppSyncAPI ..> ReactApp : "Real-time\nSubscriptions\n(WebSocket)"

Utils --> S3Bucket : "Upload Media"
S3Bucket --> ReactApp : "Media URLs"

EventBridge --> LambdaFunction : "Trigger\nDaily Schedule"
LambdaFunction --> AppSyncAPI : "Query Events"
LambdaFunction --> CloudWatch : "Logs"

AppSyncAPI --> CloudWatch : "API Logs"
S3Bucket --> CloudWatch : "Access Logs"
CognitoUserPool --> CloudWatch : "Auth Logs"
LambdaFunction --> CloudWatch : "Function Logs"

' Data Flow Labels
ReactApp -[hidden]right-> AppSyncAPI
note right of AppSyncAPI
  **Real-time Subscriptions:**
  • User presence
  • Messages
  • Moods
  • Posts/Comments
  • Calendar events
end note

note right of DynamoDB
  **10 DynamoDB Tables:**
  1. User
  2. Message
  3. Mood
  4. Prompt
  5. PromptResponse
  6. MediaPost
  7. MediaComment
  8. JournalEntry
  9. CalendarEvent
  10. UserStats
end note

note bottom of S3Bucket
  **Storage Path:**
  media/{identity_id}/*
  
  **File Types:**
  Photos, Videos,
  Audio, GIFs
end note

note left of LambdaFunction
  **Scheduled Task:**
  Runs daily at 9 AM UTC
  Checks CalendarEvent table
  Sends reminders to users
end note

legend right
  |<#FF9900> AWS Service |
  |<#4A90E2> Frontend |
  |--| Data Flow |
  |..| Real-time |
  |==| Scheduled |
endlegend

@enduml

